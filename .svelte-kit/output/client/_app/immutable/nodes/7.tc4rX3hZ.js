import"../chunks/Bzak7iHL.js";import"../chunks/DQH0u__Z.js";import{c as Ye,o as Be,e as Fe,s as f}from"../chunks/DCC44snd.js";import{p as $e,d as x,m as V,f as P,s as a,c as t,g as e,r,n as Ie,t as q,aG as W,a as y,b as qe,u as v,aC as b,e as Je,i as Xe,h as Ke,$ as We,j as Re,k as ze}from"../chunks/CZIwaskW.js";import{i as $}from"../chunks/BQ6CF9gK.js";import{r as Z,s as Ae}from"../chunks/CWrymlX0.js";import{i as Te}from"../chunks/BRtZcoHD.js";import{s as Le,a as Ze}from"../chunks/5vQelUuP.js";import{p as Qe}from"../chunks/C5eRSeFy.js";import{g as De}from"../chunks/C94zkJfw.js";import{b as Ue}from"../chunks/DiZaPGMT.js";import{i as et,u as tt}from"../chunks/lmZdkGOn.js";import{b as Q}from"../chunks/C_VOYwi-.js";import{p as rt}from"../chunks/CWmzcjye.js";import{p as he}from"../chunks/Bp-8lCth.js";var Ve="https://js.stripe.com/v3",at=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var nt=function(){for(var l=document.querySelectorAll('script[src^="'.concat(Ve,'"]')),o=0;o<l.length;o++){var m=l[o];if(at.test(m.src))return m}return null},Me=function(l){var o="",m=document.createElement("script");m.src="".concat(Ve).concat(o);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(m),m},ce=null,_e=null,be=null,st=function(l){return function(){l(new Error("Failed to load Stripe.js"))}},ot=function(l,o){return function(){window.Stripe?l(window.Stripe):o(new Error("Stripe.js not available"))}},it=function(l){return ce!==null?ce:(ce=new Promise(function(o,m){if(typeof window>"u"||typeof document>"u"){o(null);return}if(window.Stripe){o(window.Stripe);return}try{var i=nt();if(!(i&&l)){if(!i)i=Me(l);else if(i&&be!==null&&_e!==null){var j;i.removeEventListener("load",be),i.removeEventListener("error",_e),(j=i.parentNode)===null||j===void 0||j.removeChild(i),i=Me(l)}}be=ot(o,m),_e=st(m),i.addEventListener("load",be),i.addEventListener("error",_e)}catch(G){m(G);return}}),ce.catch(function(o){return ce=null,Promise.reject(o)}))},ve,lt=function(){return ve||(ve=it(null).catch(function(l){return ve=null,Promise.reject(l)}),ve)};Promise.resolve().then(function(){return lt()}).catch(function(u){console.warn(u)});console.error("Missing Stripe publishable key. Please set VITE_STRIPE_PUBLISHABLE_KEY in your environment variables.");async function dt(){throw new Error("Stripe not initialized. Check your publishable key.")}function C(u,l="USD"){const o=u/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:l}).format(o)}function ct(u){switch(console.error("Stripe error:",u),u.type){case"card_error":case"validation_error":return u.message;case"invalid_request_error":return"Invalid payment request. Please try again.";case"api_connection_error":return"Network error. Please check your connection and try again.";case"api_error":return"Payment processing error. Please try again.";case"authentication_error":return"Authentication error. Please refresh the page and try again.";case"rate_limit_error":return"Too many requests. Please wait a moment and try again.";default:return"An unexpected error occurred. Please try again."}}async function vt(u,l,o,m={}){try{const{error:i,paymentIntent:j}=await u.confirmCardPayment(l,{payment_method:{card:o,billing_details:m}});if(i)throw i;return j}catch(i){throw new Error(ct(i))}}var ut=P('<div class="bg-red-50 border border-red-200 rounded-md p-4 mb-6"><div class="flex"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> <div class="ml-3"><p class="text-sm text-red-800"> </p></div></div></div>'),mt=P('<div class="bg-gray-50 rounded-lg p-4 mb-6"><h4 class="font-medium text-gray-900 mb-2">Rental Summary</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">Item:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span class="text-gray-600">Duration:</span> <span> </span></div> <div class="flex justify-between"><span class="text-gray-600">Daily Rate:</span> <span> </span></div> <div class="flex justify-between"><span class="text-gray-600">Subtotal:</span> <span> </span></div> <div class="flex justify-between"><span class="text-gray-600">Service Fee:</span> <span> </span></div> <div class="border-t pt-2 flex justify-between font-semibold"><span>Total:</span> <span> </span></div></div></div>'),pt=Je('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing Payment...',1),ft=P('<div class="bg-white rounded-lg shadow-md p-6"><h3 class="text-lg font-semibold text-gray-900 mb-6">Payment Details</h3> <!> <!> <form class="space-y-6"><div class="space-y-4"><h4 class="font-medium text-gray-900">Billing Information</h4> <div class="grid grid-cols-2 gap-4"><div><label for="name" class="block text-sm font-medium text-gray-700">Full Name</label> <input type="text" id="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="John Doe"/></div> <div><label for="email" class="block text-sm font-medium text-gray-700">Email</label> <input type="email" id="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="john@example.com"/></div></div> <div><label for="address" class="block text-sm font-medium text-gray-700">Address</label> <input type="text" id="address" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="123 Main St"/></div> <div class="grid grid-cols-3 gap-4"><div><label for="city" class="block text-sm font-medium text-gray-700">City</label> <input type="text" id="city" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="Denver"/></div> <div><label for="state" class="block text-sm font-medium text-gray-700">State</label> <input type="text" id="state" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="CO"/></div> <div><label for="zip" class="block text-sm font-medium text-gray-700">ZIP Code</label> <input type="text" id="zip" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="80202"/></div></div></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Card Information</label> <div id="card-element" class="p-3 border border-gray-300 rounded-md bg-white"></div></div> <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></form> <div class="mt-4 flex items-center text-sm text-gray-500"><svg class="h-4 w-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> Your payment information is secure and encrypted.</div></div>');function gt(u,l){$e(l,!1);let o=he(l,"rental",8,null),m=he(l,"clientSecret",8,null),i=he(l,"amount",8,0),j=he(l,"disabled",8,!1);const G=Ye();let s=null,L=null,D=null,w=V(null),T=V(!1),d=V({name:"",email:"",address:{line1:"",city:"",state:"",postal_code:"",country:"US"}});Be(async()=>{try{s=await dt(),L=s.elements({appearance:{theme:"stripe",variables:{colorPrimary:"#10b981",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#ef4444",fontFamily:"system-ui, sans-serif",spacingUnit:"4px",borderRadius:"8px"}}}),D=L.create("card",{style:{base:{fontSize:"16px",color:"#1f2937","::placeholder":{color:"#9ca3af"}},invalid:{color:"#ef4444",iconColor:"#ef4444"}}}),D.mount("#card-element"),D.on("change",({error:n})=>{k(n?n.message:null)})}catch(n){console.error("Failed to initialize Stripe:",n),k("Failed to load payment form. Please refresh the page.")}});function k(n){x(w,n),G("error",{error:n})}async function xe(){if(!s||!D||!m()){k("Payment form not ready. Please try again.");return}if(!e(d).name||!e(d).email){k("Please fill in all required billing details.");return}x(T,!0),k(null);try{const n=await vt(s,m(),D,e(d));n.status==="succeeded"?(await Ue.entities.Payment.create({payment_intent_id:n.id}),G("success",{paymentIntent:n,rental:o()})):k("Payment was not completed. Please try again.")}catch(n){console.error("Payment error:",n),k(n.message||"Payment failed. Please try again.")}finally{x(T,!1)}}Te();var U=ft(),ee=a(t(U),2);{var we=n=>{var h=ut(),S=t(h),E=a(t(S),2),F=t(E),J=t(F,!0);r(F),r(E),r(S),r(h),q(()=>f(J,e(w))),y(n,h)};$(ee,n=>{e(w)&&n(we)})}var ue=a(ee,2);{var Se=n=>{var h=mt(),S=a(t(h),2),E=t(S),F=a(t(E),2),J=t(F,!0);r(F),r(E);var se=a(E,2),oe=a(t(se),2),ge=t(oe);r(oe),r(se);var ie=a(se,2),le=a(t(ie),2),ke=t(le,!0);r(le),r(ie);var X=a(ie,2),K=a(t(X),2),Ee=t(K,!0);r(K),r(X);var de=a(X,2),ye=a(t(de),2),Ce=t(ye,!0);r(ye),r(de);var g=a(de,2),_=a(t(g),2),je=t(_,!0);r(_),r(g),r(S),r(h),q((Ge,He,Oe,Ne)=>{f(J,(b(o()),v(()=>o().gear_title))),f(ge,`${b(o()),v(()=>o().total_days)??""} days`),f(ke,Ge),f(Ee,He),f(Ce,Oe),f(je,Ne)},[()=>(b(C),b(o()),v(()=>C(o().daily_rate*100))),()=>(b(C),b(o()),v(()=>C(o().subtotal*100))),()=>(b(C),b(o()),v(()=>C(o().service_fee*100))),()=>(b(C),b(i()),v(()=>C(i())))]),y(n,h)};$(ue,n=>{o()&&i()&&n(Se)})}var c=a(ue,2),p=t(c),I=a(t(p),2),te=t(I),me=a(t(te),2);Z(me),r(te);var R=a(te,2),z=a(t(R),2);Z(z),r(R),r(I);var A=a(I,2),H=a(t(A),2);Z(H),r(A);var M=a(A,2),B=t(M),O=a(t(B),2);Z(O),r(B);var N=a(B,2),Y=a(t(N),2);Z(Y),r(N);var re=a(N,2),pe=a(t(re),2);Z(pe),r(re),r(M),r(p);var ae=a(p,4),fe=t(ae);{var ne=n=>{var h=pt();Ie(),y(n,h)},Pe=n=>{var h=Xe();q(S=>f(h,`Pay ${S??""}`),[()=>(b(i()),b(C),v(()=>i()?C(i()):""))]),y(n,h)};$(fe,n=>{e(T)?n(ne):n(Pe,!1)})}r(ae),r(c),Ie(2),r(U),q(()=>ae.disabled=j()||e(T)||!m()),Q(me,()=>e(d).name,n=>W(d,e(d).name=n)),Q(z,()=>e(d).email,n=>W(d,e(d).email=n)),Q(H,()=>e(d).address.line1,n=>W(d,e(d).address.line1=n)),Q(O,()=>e(d).address.city,n=>W(d,e(d).address.city=n)),Q(Y,()=>e(d).address.state,n=>W(d,e(d).address.state=n)),Q(pe,()=>e(d).address.postal_code,n=>W(d,e(d).address.postal_code=n)),Fe("submit",c,rt(xe)),y(u,U),qe()}var yt=P('<meta name="description" content="Complete your rental payment securely"/>'),ht=P('<div class="flex justify-center items-center py-12"><svg class="animate-spin h-8 w-8 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span class="ml-2 text-gray-600">Loading checkout...</span></div>'),_t=P('<div class="bg-red-50 border border-red-200 rounded-md p-6 text-center"><svg class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> <h3 class="mt-2 text-lg font-medium text-red-800">Checkout Error</h3> <p class="mt-1 text-red-600"> </p> <div class="mt-4"><button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">Return to Rentals</button></div></div>'),bt=P('<img class="w-20 h-20 object-cover rounded-lg"/>'),xt=P('<div class="w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center"><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'),wt=P('<p class="text-sm text-gray-600 mt-1"> </p>'),St=P('<div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-white rounded-lg shadow-md p-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Rental Details</h2> <div class="space-y-4"><div class="flex items-start space-x-4"><!> <div class="flex-1"><h3 class="font-medium text-gray-900"> </h3> <p class="text-sm text-gray-600"> </p></div></div> <div class="border-t pt-4"><h4 class="font-medium text-gray-900 mb-2">Rental Period</h4> <div class="grid grid-cols-2 gap-4 text-sm"><div><span class="text-gray-600">Start Date:</span> <p class="font-medium"> </p></div> <div><span class="text-gray-600">End Date:</span> <p class="font-medium"> </p></div></div> <p class="text-sm text-gray-600 mt-2"> </p></div> <div class="border-t pt-4"><h4 class="font-medium text-gray-900 mb-2">Delivery Method</h4> <p class="text-sm capitalize"> </p> <!></div></div></div> <!></div>'),Pt=P('<div class="min-h-screen bg-gray-50 py-8"><div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"><div class="text-center mb-8"><h1 class="text-3xl font-bold text-gray-900">Complete Your Rental</h1> <p class="mt-2 text-gray-600">Secure checkout powered by Stripe</p></div> <!></div></div>');function Tt(u,l){$e(l,!1);const[o,m]=Ze(),i=()=>Le(Qe,"$page",o),j=()=>Le(et,"$isAuthenticated",o),G=()=>Le(tt,"$user",o);let s=V(null),L=V(null),D=V(!0),w=V(null);const T=i().params.rental_id;Be(async()=>{if(!j()){De("/auth/login?redirect="+encodeURIComponent(i().url.pathname));return}await d()});async function d(){try{x(D,!0),x(w,null);const c=await Ue.entities.Rental.get(T);if(x(s,c.rental),e(s).renter_id!==G().id){x(w,"You can only pay for your own rentals");return}if(e(s).status!=="pending"){x(w,`Rental is ${e(s).status}. Payment is only available for pending rentals.`);return}const p=await fetch("/api/payments/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({rental_id:T})});if(!p.ok){const I=await p.json();throw new Error(I.error||"Failed to create payment intent")}x(L,await p.json())}catch(c){console.error("Failed to load rental:",c),x(w,c.message)}finally{x(D,!1)}}function k(c){const{paymentIntent:p,rental:I}=c.detail;De(`/checkout/success?rental_id=${I.id}&payment_intent=${p.id}`)}function xe(c){x(w,c.detail.error)}Te();var U=Pt();Ke(c=>{var p=yt();We.title="Checkout - GearGrab",y(c,p)});var ee=t(U),we=a(t(ee),2);{var ue=c=>{var p=ht();y(c,p)},Se=c=>{var p=Re(),I=ze(p);{var te=R=>{var z=_t(),A=a(t(z),4),H=t(A,!0);r(A);var M=a(A,2),B=t(M);r(M),r(z),q(()=>f(H,e(w))),Fe("click",B,()=>De("/dashboard/rentals")),y(R,z)},me=R=>{var z=Re(),A=ze(z);{var H=M=>{var B=St(),O=t(B),N=a(t(O),2),Y=t(N),re=t(Y);{var pe=g=>{var _=bt();q(()=>{Ae(_,"src",(e(s),v(()=>e(s).gear_images[0]))),Ae(_,"alt",(e(s),v(()=>e(s).gear_title)))}),y(g,_)},ae=g=>{var _=xt();y(g,_)};$(re,g=>{e(s),v(()=>e(s).gear_images&&e(s).gear_images.length>0)?g(pe):g(ae,!1)})}var fe=a(re,2),ne=t(fe),Pe=t(ne,!0);r(ne);var n=a(ne,2),h=t(n);r(n),r(fe),r(Y);var S=a(Y,2),E=a(t(S),2),F=t(E),J=a(t(F),2),se=t(J,!0);r(J),r(F);var oe=a(F,2),ge=a(t(oe),2),ie=t(ge,!0);r(ge),r(oe),r(E);var le=a(E,2),ke=t(le);r(le),r(S);var X=a(S,2),K=a(t(X),2),Ee=t(K,!0);r(K);var de=a(K,2);{var ye=g=>{var _=wt(),je=t(_,!0);r(_),q(()=>f(je,(e(s),v(()=>e(s).delivery_address)))),y(g,_)};$(de,g=>{e(s),v(()=>e(s).delivery_address)&&g(ye)})}r(X),r(N),r(O);var Ce=a(O,2);gt(Ce,{get rental(){return e(s)},get clientSecret(){return e(L),v(()=>e(L).client_secret)},get amount(){return e(L),v(()=>e(L).amount)},$$events:{success:k,error:xe}}),r(B),q((g,_)=>{f(Pe,(e(s),v(()=>e(s).gear_title))),f(h,`Owner: ${e(s),v(()=>e(s).owner_name)??""}`),f(se,g),f(ie,_),f(ke,`Duration: ${e(s),v(()=>e(s).total_days)??""} day${e(s),v(()=>e(s).total_days!==1?"s":"")??""}`),f(Ee,(e(s),v(()=>e(s).delivery_method)))},[()=>(e(s),v(()=>new Date(e(s).start_date).toLocaleDateString())),()=>(e(s),v(()=>new Date(e(s).end_date).toLocaleDateString()))]),y(M,B)};$(A,M=>{e(s)&&e(L)&&M(H)},!0)}y(R,z)};$(I,R=>{e(w)?R(te):R(me,!1)},!0)}y(c,p)};$(we,c=>{e(D)?c(ue):c(Se,!1)})}r(ee),r(U),y(u,U),qe(),m()}export{Tt as component};
