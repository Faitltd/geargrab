import"../chunks/Bzak7iHL.js";import"../chunks/saGfK2NU.js";import{c as Ke,o as $e,e as Fe,s as f}from"../chunks/_R8EZNUK.js";import{p as Te,d as b,m as H,f as k,s as a,c as t,g as e,r,n as Re,t as T,aI as X,a as y,b as qe,u as m,aA as x,aH as Xe,aK as Ze,h as Qe,$ as et,e as ze,i as Ae}from"../chunks/BXL6jbj8.js";import{i as F}from"../chunks/CFP_NBt-.js";import{r as Z,s as Be}from"../chunks/16U5K6kX.js";import{i as Ue}from"../chunks/L1SVMyTv.js";import{s as Le,a as tt}from"../chunks/BtazKlE4.js";import{p as rt}from"../chunks/BOdDEnX7.js";import{g as De}from"../chunks/5CZu6JCa.js";import{b as He}from"../chunks/XSCeTUk_.js";import{i as at,u as nt}from"../chunks/BlYPCKuR.js";import{b as Q}from"../chunks/Cnq0ciNm.js";import{p as st}from"../chunks/CWmzcjye.js";import{p as _e}from"../chunks/DFca-MAJ.js";var Ve="https://js.stripe.com/v3",it=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var ot=function(){for(var o=document.querySelectorAll('script[src^="'.concat(Ve,'"]')),s=0;s<o.length;s++){var d=o[s];if(it.test(d.src))return d}return null},Me=function(o){var s="",d=document.createElement("script");d.src="".concat(Ve).concat(s);var l=document.head||document.body;if(!l)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return l.appendChild(d),d},lt=function(o,s){!o||!o._registerWrapper||o._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:s})},ce=null,he=null,xe=null,dt=function(o){return function(){o(new Error("Failed to load Stripe.js"))}},ct=function(o,s){return function(){window.Stripe?o(window.Stripe):s(new Error("Stripe.js not available"))}},ut=function(o){return ce!==null?ce:(ce=new Promise(function(s,d){if(typeof window>"u"||typeof document>"u"){s(null);return}if(window.Stripe){s(window.Stripe);return}try{var l=ot();if(!(l&&o)){if(!l)l=Me(o);else if(l&&xe!==null&&he!==null){var w;l.removeEventListener("load",xe),l.removeEventListener("error",he),(w=l.parentNode)===null||w===void 0||w.removeChild(l),l=Me(o)}}xe=ct(s,d),he=dt(d),l.addEventListener("load",xe),l.addEventListener("error",he)}catch(V){d(V);return}}),ce.catch(function(s){return ce=null,Promise.reject(s)}))},vt=function(o,s,d){if(o===null)return null;var l=o.apply(void 0,s);return lt(l,d),l},ue,Ge=!1,Oe=function(){return ue||(ue=ut(null).catch(function(o){return ue=null,Promise.reject(o)}),ue)};Promise.resolve().then(function(){return Oe()}).catch(function(u){Ge||console.warn(u)});var mt=function(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];Ge=!0;var l=Date.now();return Oe().then(function(w){return vt(w,s,l)})};const pt="pk_live_demo_key_replace_with_actual";let Ie=null;Ie=mt(pt);async function ft(){if(!Ie)throw new Error("Stripe not initialized. Check your publishable key.");return await Ie}function j(u,o="USD"){const s=u/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:o}).format(s)}function gt(u){switch(console.error("Stripe error:",u),u.type){case"card_error":case"validation_error":return u.message;case"invalid_request_error":return"Invalid payment request. Please try again.";case"api_connection_error":return"Network error. Please check your connection and try again.";case"api_error":return"Payment processing error. Please try again.";case"authentication_error":return"Authentication error. Please refresh the page and try again.";case"rate_limit_error":return"Too many requests. Please wait a moment and try again.";default:return"An unexpected error occurred. Please try again."}}async function yt(u,o,s,d={}){try{const{error:l,paymentIntent:w}=await u.confirmCardPayment(o,{payment_method:{card:s,billing_details:d}});if(l)throw l;return w}catch(l){throw new Error(gt(l))}}var _t=k('<div class="bg-red-50 border border-red-200 rounded-md p-4 mb-6"><div class="flex"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> <div class="ml-3"><p class="text-sm text-red-800"> </p></div></div></div>'),ht=k('<div class="bg-gray-50 rounded-lg p-4 mb-6"><h4 class="font-medium text-gray-900 mb-2">Rental Summary</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">Item:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span class="text-gray-600">Duration:</span> <span> </span></div> <div class="flex justify-between"><span class="text-gray-600">Daily Rate:</span> <span> </span></div> <div class="flex justify-between"><span class="text-gray-600">Subtotal:</span> <span> </span></div> <div class="flex justify-between"><span class="text-gray-600">Service Fee:</span> <span> </span></div> <div class="border-t pt-2 flex justify-between font-semibold"><span>Total:</span> <span> </span></div></div></div>'),xt=Xe('<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing Payment...',1),bt=k('<div class="bg-white rounded-lg shadow-md p-6"><h3 class="text-lg font-semibold text-gray-900 mb-6">Payment Details</h3> <!> <!> <form class="space-y-6"><div class="space-y-4"><h4 class="font-medium text-gray-900">Billing Information</h4> <div class="grid grid-cols-2 gap-4"><div><label for="name" class="block text-sm font-medium text-gray-700">Full Name</label> <input type="text" id="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="John Doe"/></div> <div><label for="email" class="block text-sm font-medium text-gray-700">Email</label> <input type="email" id="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="john@example.com"/></div></div> <div><label for="address" class="block text-sm font-medium text-gray-700">Address</label> <input type="text" id="address" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="123 Main St"/></div> <div class="grid grid-cols-3 gap-4"><div><label for="city" class="block text-sm font-medium text-gray-700">City</label> <input type="text" id="city" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="Denver"/></div> <div><label for="state" class="block text-sm font-medium text-gray-700">State</label> <input type="text" id="state" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="CO"/></div> <div><label for="zip" class="block text-sm font-medium text-gray-700">ZIP Code</label> <input type="text" id="zip" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="80202"/></div></div></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Card Information</label> <div id="card-element" class="p-3 border border-gray-300 rounded-md bg-white"></div></div> <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></form> <div class="mt-4 flex items-center text-sm text-gray-500"><svg class="h-4 w-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> Your payment information is secure and encrypted.</div></div>');function wt(u,o){Te(o,!1);let s=_e(o,"rental",8,null),d=_e(o,"clientSecret",8,null),l=_e(o,"amount",8,0),w=_e(o,"disabled",8,!1);const V=Ke();let i=null,L=null,D=null,S=H(null),q=H(!1),c=H({name:"",email:"",address:{line1:"",city:"",state:"",postal_code:"",country:"US"}});$e(async()=>{try{i=await ft(),L=i.elements({appearance:{theme:"stripe",variables:{colorPrimary:"#10b981",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#ef4444",fontFamily:"system-ui, sans-serif",spacingUnit:"4px",borderRadius:"8px"}}}),D=L.create("card",{style:{base:{fontSize:"16px",color:"#1f2937","::placeholder":{color:"#9ca3af"}},invalid:{color:"#ef4444",iconColor:"#ef4444"}}}),D.mount("#card-element"),D.on("change",({error:n})=>{E(n?n.message:null)})}catch(n){console.error("Failed to initialize Stripe:",n),E("Failed to load payment form. Please refresh the page.")}});function E(n){b(S,n),V("error",{error:n})}async function be(){if(!i||!D||!d()){E("Payment form not ready. Please try again.");return}if(!e(c).name||!e(c).email){E("Please fill in all required billing details.");return}b(q,!0),E(null);try{const n=await yt(i,d(),D,e(c));n.status==="succeeded"?(await He.entities.Payment.create({payment_intent_id:n.id}),V("success",{paymentIntent:n,rental:s()})):E("Payment was not completed. Please try again.")}catch(n){console.error("Payment error:",n),E(n.message||"Payment failed. Please try again.")}finally{b(q,!1)}}Ue();var U=bt(),ee=a(t(U),2);{var we=n=>{var _=_t(),P=t(_),C=a(t(P),2),$=t(C),Y=t($,!0);r($),r(C),r(P),r(_),T(()=>f(Y,e(S))),y(n,_)};F(ee,n=>{e(S)&&n(we)})}var ve=a(ee,2);{var Se=n=>{var _=ht(),P=a(t(_),2),C=t(P),$=a(t(C),2),Y=t($,!0);r($),r(C);var se=a(C,2),ie=a(t(se),2),ge=t(ie);r(ie),r(se);var oe=a(se,2),le=a(t(oe),2),ke=t(le,!0);r(le),r(oe);var J=a(oe,2),K=a(t(J),2),Ee=t(K,!0);r(K),r(J);var de=a(J,2),ye=a(t(de),2),Ce=t(ye,!0);r(ye),r(de);var g=a(de,2),h=a(t(g),2),je=t(h,!0);r(h),r(g),r(P),r(_),T((We,Ne,Ye,Je)=>{f(Y,(x(s()),m(()=>s().gear_title))),f(ge,`${x(s()),m(()=>s().total_days)??""} days`),f(ke,We),f(Ee,Ne),f(Ce,Ye),f(je,Je)},[()=>(x(j),x(s()),m(()=>j(s().daily_rate*100))),()=>(x(j),x(s()),m(()=>j(s().subtotal*100))),()=>(x(j),x(s()),m(()=>j(s().service_fee*100))),()=>(x(j),x(l()),m(()=>j(l())))]),y(n,_)};F(ve,n=>{s()&&l()&&n(Se)})}var v=a(ve,2),p=t(v),I=a(t(p),2),te=t(I),me=a(t(te),2);Z(me),r(te);var R=a(te,2),z=a(t(R),2);Z(z),r(R),r(I);var A=a(I,2),G=a(t(A),2);Z(G),r(A);var B=a(A,2),M=t(B),O=a(t(M),2);Z(O),r(M);var W=a(M,2),N=a(t(W),2);Z(N),r(W);var re=a(W,2),pe=a(t(re),2);Z(pe),r(re),r(B),r(p);var ae=a(p,4),fe=t(ae);{var ne=n=>{var _=xt();Re(),y(n,_)},Pe=n=>{var _=Ze();T(P=>f(_,`Pay ${P??""}`),[()=>(x(l()),x(j),m(()=>l()?j(l()):""))]),y(n,_)};F(fe,n=>{e(q)?n(ne):n(Pe,!1)})}r(ae),r(v),Re(2),r(U),T(()=>ae.disabled=w()||e(q)||!d()),Q(me,()=>e(c).name,n=>X(c,e(c).name=n)),Q(z,()=>e(c).email,n=>X(c,e(c).email=n)),Q(G,()=>e(c).address.line1,n=>X(c,e(c).address.line1=n)),Q(O,()=>e(c).address.city,n=>X(c,e(c).address.city=n)),Q(N,()=>e(c).address.state,n=>X(c,e(c).address.state=n)),Q(pe,()=>e(c).address.postal_code,n=>X(c,e(c).address.postal_code=n)),Fe("submit",v,st(be)),y(u,U),qe()}var St=k('<meta name="description" content="Complete your rental payment securely"/>'),Pt=k('<div class="flex justify-center items-center py-12"><svg class="animate-spin h-8 w-8 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span class="ml-2 text-gray-600">Loading checkout...</span></div>'),kt=k('<div class="bg-red-50 border border-red-200 rounded-md p-6 text-center"><svg class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> <h3 class="mt-2 text-lg font-medium text-red-800">Checkout Error</h3> <p class="mt-1 text-red-600"> </p> <div class="mt-4"><button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">Return to Rentals</button></div></div>'),Et=k('<img class="w-20 h-20 object-cover rounded-lg"/>'),Ct=k('<div class="w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center"><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'),jt=k('<p class="text-sm text-gray-600 mt-1"> </p>'),Lt=k('<div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-white rounded-lg shadow-md p-6"><h2 class="text-xl font-semibold text-gray-900 mb-4">Rental Details</h2> <div class="space-y-4"><div class="flex items-start space-x-4"><!> <div class="flex-1"><h3 class="font-medium text-gray-900"> </h3> <p class="text-sm text-gray-600"> </p></div></div> <div class="border-t pt-4"><h4 class="font-medium text-gray-900 mb-2">Rental Period</h4> <div class="grid grid-cols-2 gap-4 text-sm"><div><span class="text-gray-600">Start Date:</span> <p class="font-medium"> </p></div> <div><span class="text-gray-600">End Date:</span> <p class="font-medium"> </p></div></div> <p class="text-sm text-gray-600 mt-2"> </p></div> <div class="border-t pt-4"><h4 class="font-medium text-gray-900 mb-2">Delivery Method</h4> <p class="text-sm capitalize"> </p> <!></div></div></div> <!></div>'),Dt=k('<div class="min-h-screen bg-gray-50 py-8"><div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"><div class="text-center mb-8"><h1 class="text-3xl font-bold text-gray-900">Complete Your Rental</h1> <p class="mt-2 text-gray-600">Secure checkout powered by Stripe</p></div> <!></div></div>');function Wt(u,o){Te(o,!1);const[s,d]=tt(),l=()=>Le(rt,"$page",s),w=()=>Le(at,"$isAuthenticated",s),V=()=>Le(nt,"$user",s);let i=H(null),L=H(null),D=H(!0),S=H(null);const q=l().params.rental_id;$e(async()=>{if(!w()){De("/auth/login?redirect="+encodeURIComponent(l().url.pathname));return}await c()});async function c(){try{b(D,!0),b(S,null);const v=await He.entities.Rental.get(q);if(b(i,v.rental),e(i).renter_id!==V().id){b(S,"You can only pay for your own rentals");return}if(e(i).status!=="pending"){b(S,`Rental is ${e(i).status}. Payment is only available for pending rentals.`);return}const p=await fetch("/api/payments/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({rental_id:q})});if(!p.ok){const I=await p.json();throw new Error(I.error||"Failed to create payment intent")}b(L,await p.json())}catch(v){console.error("Failed to load rental:",v),b(S,v.message)}finally{b(D,!1)}}function E(v){const{paymentIntent:p,rental:I}=v.detail;De(`/checkout/success?rental_id=${I.id}&payment_intent=${p.id}`)}function be(v){b(S,v.detail.error)}Ue();var U=Dt();Qe(v=>{var p=St();et.title="Checkout - GearGrab",y(v,p)});var ee=t(U),we=a(t(ee),2);{var ve=v=>{var p=Pt();y(v,p)},Se=v=>{var p=ze(),I=Ae(p);{var te=R=>{var z=kt(),A=a(t(z),4),G=t(A,!0);r(A);var B=a(A,2),M=t(B);r(B),r(z),T(()=>f(G,e(S))),Fe("click",M,()=>De("/dashboard/rentals")),y(R,z)},me=R=>{var z=ze(),A=Ae(z);{var G=B=>{var M=Lt(),O=t(M),W=a(t(O),2),N=t(W),re=t(N);{var pe=g=>{var h=Et();T(()=>{Be(h,"src",(e(i),m(()=>e(i).gear_images[0]))),Be(h,"alt",(e(i),m(()=>e(i).gear_title)))}),y(g,h)},ae=g=>{var h=Ct();y(g,h)};F(re,g=>{e(i),m(()=>e(i).gear_images&&e(i).gear_images.length>0)?g(pe):g(ae,!1)})}var fe=a(re,2),ne=t(fe),Pe=t(ne,!0);r(ne);var n=a(ne,2),_=t(n);r(n),r(fe),r(N);var P=a(N,2),C=a(t(P),2),$=t(C),Y=a(t($),2),se=t(Y,!0);r(Y),r($);var ie=a($,2),ge=a(t(ie),2),oe=t(ge,!0);r(ge),r(ie),r(C);var le=a(C,2),ke=t(le);r(le),r(P);var J=a(P,2),K=a(t(J),2),Ee=t(K,!0);r(K);var de=a(K,2);{var ye=g=>{var h=jt(),je=t(h,!0);r(h),T(()=>f(je,(e(i),m(()=>e(i).delivery_address)))),y(g,h)};F(de,g=>{e(i),m(()=>e(i).delivery_address)&&g(ye)})}r(J),r(W),r(O);var Ce=a(O,2);wt(Ce,{get rental(){return e(i)},get clientSecret(){return e(L),m(()=>e(L).client_secret)},get amount(){return e(L),m(()=>e(L).amount)},$$events:{success:E,error:be}}),r(M),T((g,h)=>{f(Pe,(e(i),m(()=>e(i).gear_title))),f(_,`Owner: ${e(i),m(()=>e(i).owner_name)??""}`),f(se,g),f(oe,h),f(ke,`Duration: ${e(i),m(()=>e(i).total_days)??""} day${e(i),m(()=>e(i).total_days!==1?"s":"")??""}`),f(Ee,(e(i),m(()=>e(i).delivery_method)))},[()=>(e(i),m(()=>new Date(e(i).start_date).toLocaleDateString())),()=>(e(i),m(()=>new Date(e(i).end_date).toLocaleDateString()))]),y(B,M)};F(A,B=>{e(i)&&e(L)&&B(G)},!0)}y(R,z)};F(I,R=>{e(S)?R(te):R(me,!1)},!0)}y(v,p)};F(we,v=>{e(D)?v(ve):v(Se,!1)})}r(ee),r(U),y(u,U),qe(),d()}export{Wt as component};
