import{_ as d}from"./Dp1pzeXC.js";import{d as u,w as l}from"./_R8EZNUK.js";import{b as h}from"./XSCeTUk_.js";const o=l(null),r=l(!0),a=l(null),p=u(o,e=>!!e);u(o,e=>(e==null?void 0:e.is_email_verified)||!1);let i=null;async function f(){r.set(!0),a.set(null);try{const{auth:e,waitForAuth:c}=await d(async()=>{const{auth:n,waitForAuth:t}=await import("./BE1B0lQ-.js").then(s=>s.d);return{auth:n,waitForAuth:t}},[],import.meta.url);await c(),i=e.onAuthStateChanged(async n=>{try{if(n){console.log("Firebase user signed in:",n.email);const t=await n.getIdToken(),s=await h.auth.loginWithFirebase(t);o.set(s.user),a.set(null)}else console.log("Firebase user signed out"),o.set(null),typeof window<"u"&&localStorage.removeItem("auth_token")}catch(t){console.error("Auth state change error:",t),a.set(t.message),o.set(null)}finally{r.set(!1)}})}catch(e){console.error("Auth initialization error:",e),a.set(e.message),r.set(!1)}}function m(){i&&(i(),i=null)}f();window.addEventListener("beforeunload",m);export{p as i,o as u};
